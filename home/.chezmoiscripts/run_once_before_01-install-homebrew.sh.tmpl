#!/bin/bash
set -euo pipefail

# Skip if Homebrew is already installed
if command -v brew &>/dev/null; then
    echo "Homebrew already installed at: $(which brew)"
    exit 0
fi

echo "Installing Homebrew..."

# Install Homebrew
if [[ "$OSTYPE" == "darwin"* ]]; then
    # macOS
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    
    # Add brew to PATH based on architecture
    case "$(uname -m)" in
        arm64)
            echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
            eval "$(/opt/homebrew/bin/brew shellenv)"
            ;;
        x86_64)
            echo 'eval "$(/usr/local/bin/brew shellenv)"' >> ~/.zprofile
            eval "$(/usr/local/bin/brew shellenv)"
            ;;
    esac
elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
    # Linux
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> ~/.profile
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi

echo "Homebrew installed successfully!"